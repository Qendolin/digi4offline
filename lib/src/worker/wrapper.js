"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Writer=void 0;var _worker_threads=require("worker_threads"),_message=require("./message.js"),_events=_interopRequireDefault(require("events"));function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}class Writer extends _events.default{worker;done;constructor(a,b,c=__dirname+"/writer.js"){super(),this.worker=new _worker_threads.Worker(c,{workerData:{file:a,info:b}}),this.worker.on("message",a=>this._onMessage(a)),this.done=new Promise(a=>{this.once("done",()=>{a()})})}_onMessage(a){switch(a.action){case"write":this.emit("write",a.data);break;case"error":this.emit("error",a.data);break;case"done":this.emit("done");break;default:console.error("Unknown message action: %s",a.action)}}write(a,b,c,d,e){this.worker.postMessage(new _message.Message("add",{svgBuffer:a,imageBuffer:c,images:b,page:e,pageIndex:d}),[a.buffer,c.buffer])}end(){this.worker.postMessage(new _message.Message("end",null))}}exports.Writer=Writer;